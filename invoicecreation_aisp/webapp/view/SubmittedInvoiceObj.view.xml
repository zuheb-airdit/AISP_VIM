<mvc:View 
    controllerName="com.invoicecreation.invoicecreationaisp.controller.SubmittedInvoiceObj"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:m="sap.m"
    xmlns:f="sap.f"
    xmlns:form="sap.ui.layout.form"
    xmlns:u="sap.ui.unified"
    xmlns="sap.uxap">
    
    <ObjectPageLayout id="SubmittedObjectPageLayout" 
        showTitleInHeaderContent="true" 
        alwaysShowContentHeader="false" 
        preserveHeaderStateOnScroll="false" 
        headerContentPinnable="true" 
        headerContentPinned="false" 
        toggleHeaderOnTitleClick="true" 
        showFooter="true" 
        isChildPage="true" 
        upperCaseAnchorBar="false">
        
        <headerTitle>
            <ObjectPageDynamicHeaderTitle>
                <breadcrumbs>
                    <m:Breadcrumbs id="SubmittedbreadcrumbsId" currentLocationText="Submitted Invoice">
                        <m:Link text="Order" press="handleClose" />
                    </m:Breadcrumbs>
                </breadcrumbs>
                <expandedHeading>
                    <m:Title text="Request No: {headData>/REQUEST_NO}" wrapping="true" />
                </expandedHeading>
                <snappedHeading>
                    <m:HBox wrap="NoWrap" alignItems="Center">
                        <m:Avatar src="./Images/objPageIcon.png" displaySize="S" displayShape="Square" class="sapUiTinyMarginEnd" />
                        <m:VBox wrap="Wrap">
                            <m:Title text="{headData>/REQUEST_NO}" wrapping="true" />
                            <m:Label text="Request No:" wrapping="true" />
                        </m:VBox>
                    </m:HBox>
                </snappedHeading>
                <actions>
                    <m:Button icon="sap-icon://edit" press="onPressEdit" type="Emphasized" visible="{= ${headData>/STATUS} === 3 }" />
                </actions>
            </ObjectPageDynamicHeaderTitle>
        </headerTitle>

        <headerContent>
            <m:FlexBox wrap="Wrap" fitContainer="true" alignItems="Stretch">
                <m:Avatar src="./Images/objPageIcon.png" displaySize="L" displayShape="Square" class="sapUiMediumMarginEnd" />
                <m:VBox class="sapUiSmallMarginEnd sapUiSmallMarginBottom">
                    <m:HBox class="sapUiTinyMarginBottom">
                        <m:Label text="Vendor No:" class="sapUiTinyMarginEnd" />
                        <m:Text text="{headData>/Lifnr}" />
                    </m:HBox>
                    <m:HBox class="sapUiTinyMarginBottom">
                        <m:Label text="Vendor Name:" class="sapUiTinyMarginEnd" />
                        <m:Text text="{headData>/Name1}" />
                    </m:HBox>
                    <m:HBox class="sapUiTinyMarginBottom">
                        <m:Label text="Vendor Address:" class="sapUiTinyMarginEnd" />
                        <m:Text text="{headData>/VendorAddress}" width="8rem" />
                    </m:HBox>
                </m:VBox>

                <m:VBox class="sapUiSmallMarginEnd sapUiSmallMarginBottom">
                    <m:HBox class="sapUiTinyMarginBottom">
                        <m:Label text="Bank Key:" class="sapUiTinyMarginEnd" />
                        <m:Text text="{headData>/BankKey}" />
                    </m:HBox>
                    <m:HBox class="sapUiTinyMarginBottom">
                        <m:Label text="Bank Name:" class="sapUiTinyMarginEnd" />
                        <m:Text text="{headData>/BankName}" />
                    </m:HBox>
                    <m:HBox class="sapUiTinyMarginBottom">
                        <m:Label text="Bank Account:" class="sapUiTinyMarginEnd" />
                        <m:Text text="{headData>/BankAccount}" />
                    </m:HBox>
                </m:VBox>

                <m:VBox class="sapUiSmallMarginEnd sapUiSmallMarginBottom">
                    <m:HBox class="sapUiTinyMarginBottom">
                        <m:Label text="Status:" class="sapUiTinyMarginEnd" />
                        <m:ObjectStatus 
                            text="{path: 'headData>/STATUS', formatter: '.formatStatusText'}"
                            state="{path: 'headData>/STATUS', formatter: '.formatStatusState'}" />
                    </m:HBox>
                    <m:HBox class="sapUiTinyMarginBottom">
                        <m:Label text="Order Date:" class="sapUiTinyMarginEnd" />
                        <m:Text text="{path: 'headData>/Bedat', formatter: '.formatDate'}" />
                    </m:HBox>
                    <m:HBox class="sapUiTinyMarginBottom">
                        <m:Label text="Purchase Org:" class="sapUiTinyMarginEnd" />
                        <m:Text text="{headData>/Ekorg}" />
                    </m:HBox>
                    <m:HBox class="sapUiTinyMarginBottom">
                        <m:Label text="Amount:" class="sapUiTinyMarginEnd" />
                        <m:ObjectNumber 
                            number="{
                                parts: [{ path: 'headData>/ASNamount' }, { path: 'headData>/Waers' }],
                                type: 'sap.ui.model.type.Currency',
                                formatOptions: { showMeasure: false }
                            }" 
                            unit="{headData>/Waers}" 
                            state="Success" />
                    </m:HBox>
                     <m:HBox class="sapUiTinyMarginBottom" visible="{= ${headData>/STATUS} === 5}">
                        <m:Label text="Supplier Invoice Ref No:" class="sapUiTinyMarginEnd" />
                        <m:Text text="{headData>/supplierInvoiceRefNo}" />
                    </m:HBox> 
                </m:VBox> 
             </m:FlexBox>
        </headerContent>

        <sections>
        <ObjectPageSection title="Invoice Header">
                <subSections>
                    <ObjectPageSubSection>
                        <blocks>
                            <m:HBox class="sapUiSmallMargin">
                                <m:VBox class="sapUiMediumMarginEnd">
                                    <m:Label text="Invoice Number:" class="sapUiTinyMarginBottom" />
                                    <m:Input id="idSubInvoiceNum" width="10rem" editable="{headData>/editable}"
                                        value="{headData>/Invoicerefno}" />
                                </m:VBox>
                                <m:VBox class="sapUiMediumMarginBegin">
                                    <m:Label text="Invoice Date:" class="sapUiTinyMarginBottom" />
                                    <m:DatePicker id="idSubInvoiceDate" width="10rem" 
                                    editable="{headData>/editable}"
                                        value="{headData>/Invoicedate}" 
                                        displayFormat="yyyy-MM-dd" />
                                </m:VBox>
                            </m:HBox>
                        </blocks>
                    </ObjectPageSubSection>
                </subSections>
            </ObjectPageSection>

            <ObjectPageSection title="Item Details" titleUppercase="false">
                <subSections>
                    <ObjectPageSubSection>
                        <blocks>
                            <m:VBox>
                                <m:ScrollContainer horizontal="true" vertical="true" width="100%">
                                    <m:Table id="mySubmittedTable" items="{tableModel>/results}" inset="false" width="auto">
                                        <m:headerToolbar>
                                            <m:Toolbar>
                                                <m:Title text="Item Details" level="H2" />
                                            </m:Toolbar>
                                        </m:headerToolbar>

                                        <m:columns>
                                            <m:Column width="7rem"><m:Text text="PO Number" /></m:Column>
                                            <m:Column width="8rem"><m:Text text="ASN Number" /></m:Column>
                                            <m:Column width="4rem"><m:Text text="Item No" /></m:Column>
                                            <m:Column width="12rem"><m:Text text="Material Description" /></m:Column>
                                            <m:Column width="5rem"><m:Text text="UOM" /></m:Column>
                                            <m:Column width="6rem"><m:Text text="ASN Qty" /></m:Column>
                                            <m:Column width="7rem"><m:Text text="ASN Amt" /></m:Column>
                                            <m:Column width="6rem"><m:Text text="GRN Qty" /></m:Column>
                                            <m:Column width="7rem"><m:Text text="GRN Amt" /></m:Column>
                                            <m:Column width="5rem"><m:Text text="Tax %" /></m:Column>
                                            <m:Column width="6rem"><m:Text text="Tax Amt" /></m:Column>
                                            <m:Column width="6rem"><m:Text text="Total Amt" /></m:Column>
                                        </m:columns>

                                        <m:items>
                                            <m:ColumnListItem>
                                                <m:cells>
                                                    <m:Text text="{tableModel>Ebeln}" />
                                                    <m:Text text="{tableModel>Vbeln}" />
                                                    <m:Text text="{tableModel>Ebelp}" />
                                                    <m:Text text="{tableModel>Txz01}" />
                                                    <m:Text text="{tableModel>Meins}" />
                                                    <m:ObjectNumber number="{tableModel>AsnQty}" unit="NOS" />
                                                    <m:ObjectNumber number="{tableModel>ASNitAmount}" unit="INR" />
                                                    <m:ObjectNumber number="{tableModel>Menge}" unit="NOS" />
                                                    <m:ObjectNumber number="{tableModel>GRNitAmount}" unit="INR" />
                                                    <m:Text text="{tableModel>Taxper}" />
                                                    <m:ObjectNumber number="{tableModel>Taxval}" unit="INR" />
                                                    <m:ObjectNumber number="{tableModel>Total}" unit="INR" />
                                                </m:cells>
                                            </m:ColumnListItem>
                                        </m:items>
                                    </m:Table>
                                </m:ScrollContainer>

                                <m:HBox justifyContent="End" alignItems="Center" 
                                    class="sapUiSmallMarginTop sapUiSmallMarginBottom sapUiSmallMarginEnd">
                                    <m:Label text="Total Amount:" class="sapUiTinyMarginEnd" />
                                    <m:ObjectNumber number="{headData>/TotalAmount}" unit="INR" />
                                </m:HBox>
                            </m:VBox>
                        </blocks>
                    </ObjectPageSubSection>
                </subSections>
            </ObjectPageSection>

            <ObjectPageSection title="Attachments">
                <subSections>
                    <ObjectPageSubSection>
                        <blocks>
                            <m:Panel class="sapUiNoContentPadding">
                                <m:VBox class="sapUiSmallMargin sapUiSmallMarginTop sapUiSmallMarginBottom">
                                    <!-- Supported Attachment Types and Size Limit -->
                                    <m:MessageStrip text="Supported Attachment Types: txt, pdf, xlsx, csv. Attachment Size up to 5 MB" showIcon="true" showCloseButton="false" class="sapUiTinyMarginBottom" visible="{headData>/editable}"/>

                                    <m:HBox justifyContent="SpaceBetween" alignItems="Center" class="sapUiTinyMarginBottom">
                                        <m:Title level="H3" id="submittedAttachmentsCountTitle"
                                            text="Attachments ({= ${attachmentsModel>/attachments}.length })" />

                                        <u:FileUploader id="subfileUploader" change="onFileSelected" fileType="xlsx,csv,pdf" buttonOnly="true" buttonText="Upload" uploadComplete="onFileSelected"                     
                                        visible="{= ${headData>/editable} &amp;&amp; ${attachmentsModel>/attachments}.length === 0}"  />
                                    </m:HBox>


                                    <m:List id="submittedattachmentsList" 
                                        items="{attachmentsModel>/attachments}" 
                                        inset="false" 
                                        noDataText="No attachments found." 
                                        class="sapUiNoMargin">
                                        <m:CustomListItem>
                                            <m:HBox justifyContent="SpaceBetween" alignItems="Center" class="sapUiSmallMargin">
                                                <m:HBox alignItems="Center">
                                                    <core:Icon src="sap-icon://document-text" size="2rem" class="sapUiSmallMarginEnd" />
                                                    <m:VBox>
                                                        <m:Text text="{attachmentsModel>IMAGE_FILE_NAME}" class="sapUiTinyMarginBottom" />
                                                        <m:Text text="Status: {attachmentsModel>STATUS} Â· Comment: {attachmentsModel>COMMENT}" />
                                                    </m:VBox>
                                                </m:HBox>
                                                <m:Button icon="sap-icon://show" type="Transparent" 
                                                    tooltip="Preview Attachment" 
                                                    press="onPreviewAttachment" 
                                                    class="sapUiTinyMarginEnd">
                                                    <m:customData>
                                                        <core:CustomData key="imageUrl" value="{attachmentsModel>IMAGEURL}" writeToDom="false" />
                                                    </m:customData>
                                                </m:Button>
                                            </m:HBox>
                                        </m:CustomListItem>
                                    </m:List>
                                </m:VBox>
                            </m:Panel>
                        </blocks>
                    </ObjectPageSubSection>
                </subSections>
            </ObjectPageSection>
        </sections>

        <footer>
            <m:Toolbar id="otbSubmittedFooter">
                <m:ToolbarSpacer />
                <m:Button type="Back" text="Back" press="handleClose" />
                <!-- Submit Button: Visible only when editable is false -->
                <m:Button id="idSubBtn" type="Success" icon="sap-icon://complete" text="Submit" press="onInvoiceSubmit" visible="{= !${headData>/editable} &amp;&amp; ${headData>/STATUS} === 3}" /> 
            </m:Toolbar>
        </footer>
    </ObjectPageLayout>
</mvc:View>